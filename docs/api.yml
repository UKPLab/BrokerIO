asyncapi: 2.5.0
info:
    title: NLP API Broker
    version: 0.1.0
    description: |
        This is the API Broker for the NLP API. It is possible to publish skills to the broker and send task to the skills.
servers:
    broker:
        url: http://peer.ukp.informatik.tu-darmstadt.de:4853
        protocol: wss

channels:
  /:
    publish:
      message:
        oneOf:
          - $ref: "#/components/messages/skillRegister"
          - $ref: "#/components/messages/skillGetAll"
          - $ref: "#/components/messages/skillRequest"
    subscribe:
      message:
        oneOf:
          - $ref: "#/components/messages/skillUpdate"

components:
  messages:
    skillRegister:
      name: skillRegister
      title: Register a skill
      summary: Register a new skill at the broker for further usage.
      payload:
        type: object
        description: Object from the Skill Definition File (SDF)
        $ref: "#/components/schemas/SDF"
    skillGetAll:
      name: skillGetAll
      title: Get all skills
      summary: Get all skills currently registered at the broker
      payload:
        type: array
        description: Array of all skills currently registered at the broker
        items:
          type: object
          description: Object from the Skill Definition File (SDF)
          $ref: "#/components/schemas/SDF"
    skillRequest:
      name: skillRequest
      title: Request a skill
      summary: Request a skill to be executed
      payload:
        type: object
        properties:
          skill:
            type: string
            description: Name of the skill to be executed
          input:
            type: object
            description: Input for the skill defined in the Skill Definition File (SDF)
            $ref: "#/components/schemas/SDFInput"
    skillUpdate:
      name: skillUpdate
      title: Update information about a skill
      summary: Update information about a skill on client side, send by the server
      payload:
        type: object
        properties:
          id:
            type: string
            description: unique ID of the skill
          status:
            type: string
            description: Status of the skill
          config:
            type: object
            description: Skill Definition File (SDF)
            $ref: "#/components/schemas/SDF"
  schemas:
    SDFInput:
      type: object
      description: Input object that should be processed by the skill
      properties:
        data:
          type: object
          description: The actual data that should be processed
        example:
          description: Please provide an example of this entry as a json
          format: json
    SDF:
      type: object
      properties:
        name:
          type: string
          description: Name of the Skill
        description:
          type: string
          description: Description of the Skill
        needs:
          type: array
          description: Array of pre executed skills before sending it to the current task
          default: []
        config:
          type: object
          description: Configuration that can be set by the user
          properties:
            data:
              type: object
              description: Object with the data that can be set by the user
            example:
              description: Please provide an example of this entry as a json
              format: json
            required:
              type: boolean
              default: false
              description: Does the user have to send the config in each request?
        input:
          $ref: "#/components/schemas/SDFInput"
        output:
          type: object
          description: Structure of the output object that is returned by the skill
          properties:
            data:
              type: object
              description: The actual data object that is returned by the skill
            example:
              description: Please provide an example of this entry as a json
              format: json